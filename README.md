## Использовал различные ридеры csv

Самым быстрым оказался RapidCsv reader, так как он лочит весь файл в память и быстро ищет нужные столбцы. Так, например, с его помощью можно прочитать только второй столбец, и если он не подходит, вовсе не парсить первый столбец с данными.

## Парсил json

Использовал несколько подходов.
* Самым быстрым и удобным по имплементации способом распарсить строку было использовать nlohmannjson.
Решение простое и изящное в коде, но очень медленное на железе.
* Чуть больше времени потребовалось, чтобы разобраться с работой simdjson. Библиотека оказалось действительно крутой, дала прирост производительности в 5-6 раз. Но тем не менее это решение не эффективно.
* Написал кастомный скалярный парсер. Простое и эффективное кастомное решение, когда точно известен формат данных. Ускорение ещё в 3 раза.
* Главным челленджем было написать avx2-парсер, который конвертирует строки в векторных регистрах. На удивление, написать его получилось всего за несколько часов (с учётом прочтения статей про sse и avx). Прирост скорости ещё в 2 раза дал в среднем 600-700 наносекунд на парсинг одного сообщение.

## Бенчмарки

Для бенчмаркинга использовал кастомный бенчмарк с готовой сишной имплементацией hdr_histogram. Результаты разбиты по перцентилям, можно удобно оценить время работы.

```
2024-11-04 16:25:27	Info: Benchmark for: ReaderType::Fastcsv
  Value (ns)   Percentile   TotalCount            %

      30.000     0.000000            1         0.00
     300.000     0.166667        21398        16.67
     310.000     0.333333        34509        33.33
     321.000     0.500000        48834        50.00
     341.000     0.583333        57938        58.33
     381.000     0.666667        64416        66.67
     612.000     0.750000        71491        75.00
     801.000     0.791667        75475        79.17
     982.000     0.833333        79609        83.33
    1183.000     0.875000        83435        87.50
    1312.000     0.895833        85400        89.58
    1483.000     0.916667        87419        91.67
    1713.000     0.937500        89412        93.75
    1883.000     0.947917        90364        94.79
    2105.000     0.958333        91355        95.83
    2335.000     0.968750        92419        96.88
    2405.000     0.973958        92900        97.40
    2505.000     0.979167        93350        97.92
    2635.000     0.984375        93851        98.44
    2715.000     0.986979        94082        98.70
    2865.000     0.989583        94334        98.96
    2985.000     0.992188        94578        99.22
#[Mean    =      600.864, StdDeviation   =      680.933]
#[Max     =    48031.000, Total count    =        95319]
#[Buckets =            7, SubBuckets     =         2048]

2024-11-04 16:25:27	Info: Benchmark for: ReaderType::Vinces
  Value (ns)   Percentile   TotalCount            %

      60.000     0.000000        10606         0.00
      70.000     0.166667        35310        16.67
      70.000     0.333333        35310        33.33
      81.000     0.500000        48931        50.00
      91.000     0.583333        55903        58.33
     140.000     0.666667        65205        66.67
     161.000     0.750000        72093        75.00
     190.000     0.791667        75663        79.17
     291.000     0.833333        79482        83.33
    1001.000     0.875000        83433        87.50
    1293.000     0.895833        85417        89.58
    1503.000     0.916667        87405        91.67
    1733.000     0.937500        89397        93.75
    1893.000     0.947917        90387        94.79
    2145.000     0.958333        91395        95.83
    2445.000     0.968750        92383        96.88
    2575.000     0.973958        92870        97.40
    2675.000     0.979167        93410        97.92
    2757.000     0.984375        93868        98.44
    2815.000     0.986979        94116        98.70
    2885.000     0.989583        94353        98.96
    3035.000     0.992188        94601        99.22
#[Mean    =      354.651, StdDeviation   =      821.252]
#[Max     =    79871.000, Total count    =        95345]
#[Buckets =            7, SubBuckets     =         2048]

2024-11-04 16:25:27	Info: Benchmark for: ReaderType::Rapidcsv
  Value (ns)   Percentile   TotalCount            %

      20.000     0.000000         9558         0.00
      30.000     0.166667        38590        16.67
      30.000     0.333333        38590        33.33
      40.000     0.500000        49466        50.00
      80.000     0.583333        56330        58.33
     100.000     0.666667        64359        66.67
     120.000     0.750000        73696        75.00
     130.000     0.791667        76196        79.17
     151.000     0.833333        79562        83.33
     201.000     0.875000        83546        87.50
     231.000     0.895833        85697        89.58
     261.000     0.916667        87685        91.67
     300.000     0.937500        89501        93.75
     321.000     0.947917        90627        94.79
     341.000     0.958333        91470        95.83
     371.000     0.968750        92392        96.88
     391.000     0.973958        92910        97.40
     420.000     0.979167        93390        97.92
     451.000     0.984375        93974        98.44
     471.000     0.986979        94169        98.70
     501.000     0.989583        94402        98.96
     531.000     0.992188        94610        99.22
#[Mean    =       96.556, StdDeviation   =      209.260]
#[Max     =    47135.000, Total count    =        95348]
#[Buckets =            7, SubBuckets     =         2048]

2024-11-04 16:25:27	Info: Benchmark for: ParserType::NlohmannJson
  Value (ns)   Percentile   TotalCount            %

    2737.000     0.000000            1         0.00
    8863.000     0.166667         6566        16.67
   11343.000     0.333333        13096        33.33
   14031.000     0.500000        19622        50.00
   15751.000     0.583333        22904        58.33
   17887.000     0.666667        26166        66.67
   20927.000     0.750000        29420        75.00
   23103.000     0.791667        31050        79.17
   25999.000     0.833333        32689        83.33
   28303.000     0.875000        34330        87.50
   29087.000     0.895833        35138        89.58
   29695.000     0.916667        35954        91.67
   31199.000     0.937500        36771        93.75
   32031.000     0.947917        37191        94.79
   32511.000     0.958333        37592        95.83
   32863.000     0.968750        38001        96.88
   33087.000     0.973958        38231        97.40
   33343.000     0.979167        38413        97.92
   34111.000     0.984375        38609        98.44
   35167.000     0.986979        38714        98.70
   36639.000     0.989583        38815        98.96
   40351.000     0.992188        38915        99.22
#[Mean    =    16313.999, StdDeviation   =     8357.335]
#[Max     =   115199.000, Total count    =        39221]
#[Buckets =            7, SubBuckets     =         2048]

2024-11-04 16:25:27	Info: Benchmark for: ParserType::SimdJson
  Value (ns)   Percentile   TotalCount            %

     601.000     0.000000            2         0.00
    1783.000     0.166667         6570        16.67
    2305.000     0.333333        13115        33.33
    2835.000     0.500000        19638        50.00
    3147.000     0.583333        22944        58.33
    3507.000     0.666667        26157        66.67
    3857.000     0.750000        29448        75.00
    4079.000     0.791667        31071        79.17
    4291.000     0.833333        32729        83.33
    4571.000     0.875000        34348        87.50
    4739.000     0.895833        35183        89.58
    4971.000     0.916667        35990        91.67
    5263.000     0.937500        36789        93.75
    5403.000     0.947917        37193        94.79
    5543.000     0.958333        37592        95.83
    5783.000     0.968750        38019        96.88
    5903.000     0.973958        38209        97.40
    6063.000     0.979167        38412        97.92
    6263.000     0.984375        38615        98.44
    6415.000     0.986979        38724        98.70
    6635.000     0.989583        38818        98.96
    7083.000     0.992188        38918        99.22
#[Mean    =     3102.049, StdDeviation   =     1840.826]
#[Max     =    86143.000, Total count    =        39224]
#[Buckets =            7, SubBuckets     =         2048]

2024-11-04 16:25:27	Info: Benchmark for: ParserType::Custom
  Value (ns)   Percentile   TotalCount            %

     110.000     0.000000            4         0.00
     611.000     0.166667         6654        16.67
     811.000     0.333333        13198        33.33
    1021.000     0.500000        19630        50.00
    1152.000     0.583333        22940        58.33
    1322.000     0.666667        26166        66.67
    1543.000     0.750000        29455        75.00
    1703.000     0.791667        31066        79.17
    1914.000     0.833333        32736        83.33
    2075.000     0.875000        34364        87.50
    2115.000     0.895833        35182        89.58
    2185.000     0.916667        35960        91.67
    2305.000     0.937500        36853        93.75
    2335.000     0.947917        37206        94.79
    2375.000     0.958333        37649        95.83
    2415.000     0.968750        38071        96.88
    2435.000     0.973958        38226        97.40
    2475.000     0.979167        38429        97.92
    2535.000     0.984375        38620        98.44
    2565.000     0.986979        38725        98.70
    2595.000     0.989583        38819        98.96
    2625.000     0.992188        38923        99.22
#[Mean    =     1192.027, StdDeviation   =      774.119]
#[Max     =    23647.000, Total count    =        39225]
#[Buckets =            7, SubBuckets     =         2048]

2024-11-04 16:25:27	Info: Benchmark for: ParserType::CustomAvx
  Value (ns)   Percentile   TotalCount            %

     160.000     0.000000            2         0.00
     391.000     0.166667         7100        16.67
     461.000     0.333333        13198        33.33
     551.000     0.500000        20180        50.00
     601.000     0.583333        23042        58.33
     671.000     0.666667        26294        66.67
     761.000     0.750000        29452        75.00
     822.000     0.791667        31082        79.17
     901.000     0.833333        32756        83.33
     942.000     0.875000        34516        87.50
     961.000     0.895833        35213        89.58
     972.000     0.916667        35983        91.67
    1002.000     0.937500        36940        93.75
    1012.000     0.947917        37250        94.79
    1032.000     0.958333        37755        95.83
    1052.000     0.968750        38054        96.88
    1072.000     0.973958        38239        97.40
    1102.000     0.979167        38466        97.92
    1142.000     0.984375        38614        98.44
    1172.000     0.986979        38715        98.70
    1212.000     0.989583        38823        98.96
    1243.000     0.992188        38932        99.22
#[Mean    =      616.678, StdDeviation   =      423.878]
#[Max     =    33375.000, Total count    =        39225]
#[Buckets =            7, SubBuckets     =         2048]
```


